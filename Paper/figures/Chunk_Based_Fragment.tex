
% Chunk based fragment
\begin{tikzpicture}

	\newcommand\drawChunkPhase[1]{
			% edef worked here because I was defining \def\phaseNum{\phaseNum} which recurses
			% infinitely. \edef worked because it expanded \phaseNum before assigning it to 
			% the new macro.
		\def\phaseNumIn{#1}
% Thread\register layout
		\foreach \row in {0, ..., 7} {
			\ifnum \phaseNumIn<3
				\def\firstDim{1}
			\else
				\def\firstDim{9}
			\fi
			\pgfmathsetmacro\maxDim{int(\firstDim + 7)}
            
			\pgfmathsetmacro\thread{int((\phaseNumIn - 1) * 8 + \row)}
                \pgfmathtruncatemacro\pointIndex{\thread + 1}
			\coordinate (C) at (0, -\row * \registerHeight);
                \coordinate (L) at ($(C)+(0, -\halfRegisterHeight)$);

			\def\chunkColor{\getPhaseColor{\phaseNumIn}}
			\filldraw[fill=\chunkColor, draw=black] (C) rectangle +(4 * \registerWidth, -\registerHeight) node[midway, font=\tiny] {\firstDim-\maxDim} node[midway, anchor=west, xshift=-0.8 cm, font=\tiny] {\texttt{T\thread}} ;
            \ifnum \phaseNumIn<3
                \node[anchor=west, xshift=-0.45cm, font=\tiny] at (L) {$P_{\pointIndex}$};
            \fi
		}
	}

	\drawFragment{\drawChunkPhase}

\end{tikzpicture}
